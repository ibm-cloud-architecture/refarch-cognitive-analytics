



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.0.1">
    
    
      
        <title>Deployments - Customer analysis with cognitive and analytics in hybrid cloud</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.982221ab.css">
      
      
    
    
      <script src="../assets/javascripts/modernizr.1f0bcf2b.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../extra.css">
    
    
      
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="__github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#run-the-different-components-of-the-solution" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href=".." title="Customer analysis with cognitive and analytics in hybrid cloud" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Customer analysis with cognitive and analytics in hybrid cloud
            </span>
            <span class="md-header-nav__topic">
              Deployments
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/ibm-cloud-architecture/refarch-cognitive-analytics/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    GitHub
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href=".." title="Customer analysis with cognitive and analytics in hybrid cloud" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    Customer analysis with cognitive and analytics in hybrid cloud
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/ibm-cloud-architecture/refarch-cognitive-analytics/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Welcome" class="md-nav__link">
      Welcome
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../method/readme/" title="Methodology" class="md-nav__link">
      Methodology
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Business Problem
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Business Problem
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../businessproblem/" title="Presentation" class="md-nav__link">
      Presentation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../flow/" title="Demonstration" class="md-nav__link">
      Demonstration
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Design
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Design
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../design/readme/" title="Design considerations" class="md-nav__link">
      Design considerations
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../design/code/" title="Implementation details" class="md-nav__link">
      Implementation details
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Deployments
      </label>
    
    <a href="./" title="Deployments" class="md-nav__link md-nav__link--active">
      Deployments
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#pre-requisites" title="Pre-Requisites" class="md-nav__link">
    Pre-Requisites
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#server-environment" title="Server environment" class="md-nav__link">
    Server environment
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#for-the-web-app-built-using-nodejs-and-expressjs" title="For the Web App built using nodejs and expressjs" class="md-nav__link">
    For the Web App built using nodejs and expressjs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#for-watson-conversation-service" title="For Watson Conversation service" class="md-nav__link">
    For Watson Conversation service
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#for-tone-analyzer" title="For Tone analyzer" class="md-nav__link">
    For Tone analyzer
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#build" title="Build" class="md-nav__link">
    Build
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#for-the-web-app" title="For the Web App" class="md-nav__link">
    For the Web App
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jenkins-pipeline" title="Jenkins pipeline" class="md-nav__link">
    Jenkins pipeline
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#run" title="Run" class="md-nav__link">
    Run
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#run-the-web-application-locally" title="Run the web application locally" class="md-nav__link">
    Run the web application locally
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#run-web-app-on-ibm-cloud-private" title="Run web app on IBM Cloud Private" class="md-nav__link">
    Run web app on IBM Cloud Private
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deploy-the-release-using-the-helm" title="Deploy the release using the helm" class="md-nav__link">
    Deploy the release using the helm
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#modify-deploymentyaml" title="Modify deployment.yaml" class="md-nav__link">
    Modify deployment.yaml
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#run-the-jupyter-notebook" title="Run the Jupyter notebook" class="md-nav__link">
    Run the Jupyter notebook
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#pre-requisites" title="Pre-Requisites" class="md-nav__link">
    Pre-Requisites
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#server-environment" title="Server environment" class="md-nav__link">
    Server environment
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#for-the-web-app-built-using-nodejs-and-expressjs" title="For the Web App built using nodejs and expressjs" class="md-nav__link">
    For the Web App built using nodejs and expressjs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#for-watson-conversation-service" title="For Watson Conversation service" class="md-nav__link">
    For Watson Conversation service
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#for-tone-analyzer" title="For Tone analyzer" class="md-nav__link">
    For Tone analyzer
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#build" title="Build" class="md-nav__link">
    Build
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#for-the-web-app" title="For the Web App" class="md-nav__link">
    For the Web App
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jenkins-pipeline" title="Jenkins pipeline" class="md-nav__link">
    Jenkins pipeline
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#run" title="Run" class="md-nav__link">
    Run
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#run-the-web-application-locally" title="Run the web application locally" class="md-nav__link">
    Run the web application locally
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#run-web-app-on-ibm-cloud-private" title="Run web app on IBM Cloud Private" class="md-nav__link">
    Run web app on IBM Cloud Private
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deploy-the-release-using-the-helm" title="Deploy the release using the helm" class="md-nav__link">
    Deploy the release using the helm
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#modify-deploymentyaml" title="Modify deployment.yaml" class="md-nav__link">
    Modify deployment.yaml
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#run-the-jupyter-notebook" title="Run the Jupyter notebook" class="md-nav__link">
    Run the Jupyter notebook
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/ibm-cloud-architecture/refarch-cognitive-analytics/edit/master/docs/run.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="run-the-different-components-of-the-solution">Run the different components of the solution</h1>
<p>This section addresses how to run all the components of the solution. It is not a tutorial and you need to have hands on experience on IBM Cloud Private and IBM Cloud. You also need access to Virtual Machines to be able to run the solution.</p>
<h2 id="pre-requisites">Pre-Requisites</h2>
<h3 id="server-environment">Server environment</h3>
<p><em>If you work for IBM, please contact us so you can access our labs via VPN.</em></p>
<p>If you want to setup the environment on your own you will need 4 computers/ VMs:
<em> an ICP cluster with at the bare minimum of 3 VMs: one master node, one proxy and one worker node. This is for the run time. For the analytics part, using DSX, you can use the IBM Cloud service or use the <code>DSX developer chart</code> from the ICP catalog, and use your ICP instance.
</em> One VM for DB2 community edition, Liberty
In the close future we plan to deliver a Vagrant file to get a unique virtual environment with DB2 dev, Liberty, and you can use <a href="https://github.com/IBM/deploy-ibm-cloud-private">this vagrant</a> file for ICP.</p>
<p>In production you will use a dedicated cluster with DSX local deployed on it. This is out environment as explained <a href="https://github.com/ibm-cloud-architecture/refarch-analytics/tree/master/docs/ICP/README.md">in this note</a></p>
<h3 id="for-the-web-app-built-using-nodejs-and-expressjs">For the Web App built using nodejs and expressjs</h3>
<ul>
<li>For this application you need to have <a href="https://nodejs.org/en/">nodejs</a> installed on your computer with the <a href="https://www.npmjs.com/">npm</a> installer tool.</li>
<li>Clone this current repository, or if you want to work on the code, fork it in your own github repository and then clone your forked repository on your local computer. If you used the <code>fork-repos.sh</code> script from the <a href="https://github.com/ibm-cloud-architecture/refarch-analytics">Data &amp; Analytics reference implementation solution</a> main repository, you are already set.</li>
</ul>
<pre><code>git clone https://github.com/ibm-cloud-architecture/refarch-cognitive-analytics
cd refarch-cognitive-analytics/src
npm install
</code></pre>

<ul>
<li>You need to install Angular 4 command line interface if you do not have it yet: see the <a href="http://cli.angular.io">cli.angular.io website</a> with the following command</li>
</ul>
<p><code>sudo  npm install -g @angular/cli</code>
 on Mac, as a global install you need to be <code>root</code> user or a "sudoer" user.
* If you want to tune the server code, you need to install <a href="https://nodemon.io/">nodemon</a> to support server code change without stopping the server. The installation is done with <code>npm</code>:</p>
<pre><code>sudo npm install -g nodemon
</code></pre>

<h3 id="for-watson-conversation-service">For Watson Conversation service</h3>
<p>Create the service in IBM Cloud and get the credentials, update the configuration file (config.json and values.yaml) for the webapp to access the conversation service. <a href="../wcs/">See this note about implementation</a></p>
<h3 id="for-tone-analyzer">For Tone analyzer</h3>
<p>Create the service in IBM Cloud and get the credentials. See also <a href="../w-tone-analyzer/">this note</a> for more details.</p>
<h2 id="build">Build</h2>
<h3 id="for-the-web-app">For the Web App</h3>
<p>To build the angular 4 components run the commands under the <code>src</code> folder:</p>
<pre><code>$ ng build
or
$ npm run build
</code></pre>

<p>When involving a continuous integration using Jenkins, the jenkins file executes the script in the good order:</p>
<pre><code>stage('build') {
    steps {
        sh 'build.sh'
    }
}
</code></pre>

<p>When compiling the angular typescripts the javascript code generated is saved under <code>dist</code> folder. It will be packaged when a docker image is built.</p>
<p>We have added a build.sh shell script which uses a version number (0.0.6) to build the docker image with good tagging and modify the helm chart with the good tag reference.</p>
<h3 id="jenkins-pipeline">Jenkins pipeline</h3>
<p>We deployed a Jenkins server on IBM Cloud Private following the instructions described <a href="https://github.com/ibm-cloud-architecture/refarch-integration/tree/master/docs/devops#jenkins-on-icp">here</a>, with a PVC named <code>jenkins-home</code> under the greencompute namespace and the commands:</p>
<pre><code>$ helm install --name greenjenkins --set Persistence.ExistingClaim=jenkins-home --set Master.ImageTag=2.67 stable/jenkins --namespace greencompute
$ cd chart/jenkins
$ kubectl create -f docker-reg-configMap.yaml --namespace greencompute
$ kubectl create -f registry-secret.yaml --namespace greencompute
</code></pre>

<p>Then we added configMap and secret in kubernetes cluster to keep docker private registry information so that build job can publish docker images to the registry automatically.</p>
<p>The webapp and customer service projects have jenkinsfile that can be used in a Jenkins Pipeline. Pipelines are made up of multiple steps that allow you to build, test and deploy applications.</p>
<p><img alt="" src="../green-web-pipeline.png" /></p>
<p>Then define the URL of the github repository and specify the branch to checkout.</p>
<p><img alt="" src="../pipeline-web.png" />
The pipeline is created. You can manually start the build job that runs the pipeline. The job pulls the code from Git repository's master branch and runs the Jenkins file. Then, it builds the Docker image and pushes it to the IBM Cloud Private Docker registry.</p>
<h2 id="run">Run</h2>
<h3 id="run-the-web-application-locally">Run the web application locally</h3>
<p>To start the application using node monitoring tool use the command:</p>
<pre><code>npm run dev
</code></pre>

<p>To run in non-development mode</p>
<pre><code>npm start
</code></pre>

<p>The trace should display a message like below with the url to use</p>
<pre><code>[1] starting `node server/server server/server`
[1] Server v0.0.1 starting on http://localhost:3001
</code></pre>

<p>Point your web browser to the url: <a href="http://localhost:3001">http://localhost:3001</a> to get access to the user interface of the home page.</p>
<p>The demonstration script is described in this <a href="docs/flow/README.md">note</a></p>
<h3 id="run-web-app-on-ibm-cloud-private">Run web app on IBM Cloud Private</h3>
<p>The application can be deployed with <code>helm install</code>. Once the docker image is built, you need to remote connect to the master node where the docker private repository resides, and push the image to the repo:</p>
<pre><code>$ docker build -t ibmcase/greenapp .
$ docker tag ibmcase/greenapp  greencluster.icp:8500/greencompute/greenapp:v0.0.1
$ docker login greencluster.icp:8500
$ docker push greencluster.icp:8500/greencompute/greenapp:v0.0.1
</code></pre>

<h4 id="deploy-the-release-using-the-helm">Deploy the release using the helm</h4>
<p>First you need to rename the file <code>values-tmpl.yaml</code> to <code>values.yaml</code> and set the parameters as the config.json. We are using the mechanism of config map to externalize the configuration as defined by the <code>config.json</code>. While using cloud foundry or pure local nodejs deployment this file is read from the filesystem by the server.js. But with kubernetes pods the best practice is to export this configuration into <code>ConfigMap</code>.
To do so we need to create a new template: <code>templates/configmap.yaml</code>. This file uses the same structure as the <code>config.json</code> file:</p>
<pre><code class="yaml">apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ template &quot;fullname&quot; . }}
  labels:
    chart: &quot;{{ .Chart.Name }}-{{ .Chart.Version | replace &quot;+&quot; &quot;_&quot; }}&quot;
data:
  config.json: |+
    {
    &quot;conversation&quot; :{
        &quot;version&quot; : &quot;{{ .Values.config.conversation.version }}&quot;,
        &quot;versionDate&quot;:&quot;{{ .Values.config.conversation.versionDate }}&quot;,
        &quot;username&quot;:&quot;{{ .Values.config.conversation.username }}&quot;,
        &quot;password&quot;:&quot;{{ .Values.config.conversation.password }}&quot;,
        &quot;conversationId&quot;:&quot;{{ .Values.config.conversation.conversationId }}&quot;,
        &quot;workspace&quot;:&quot;{{ .Values.config.conversation.workspace }}&quot;,
        &quot;usePersistence&quot;: &quot;{{ .Values.config.conversation.usePersistence }}&quot;
      },
    &quot;customerAPI&quot;:{
          &quot;url&quot;:&quot;{{ .Values.config.customerAPI.url }}&quot;,
          &quot;host&quot;:&quot;{{ .Values.config.customerAPI.host }}&quot;,
          &quot;xibmclientid&quot;: &quot;{{ .Values.config.customerAPI.xibmclientid }}&quot;
    },
    &quot;toneAnalyzer&quot;:{
          &quot;url&quot;: &quot;{{ .Values.config.toneAnalyzer.url }}&quot;,
          &quot;versionDate&quot;: &quot;{{ .Values.config.toneAnalyzer.versionDate }}&quot;,
          &quot;username&quot;: &quot;{{ .Values.config.toneAnalyzer.username }}&quot;,
          &quot;password&quot;: &quot;{{ .Values.config.toneAnalyzer.password }}&quot;
    },
    &quot;scoringService&quot;:{
        &quot;type&quot;: &quot;{{ .Values.config.scoringService.type }}&quot;,
        &quot;baseUrl&quot;: &quot;{{ .Values.config.scoringService.baseUrl }}&quot;,
        &quot;instance&quot;: &quot;{{ .Values.config.scoringService.instance }}&quot;,
        &quot;username&quot;: &quot;{{ .Values.config.scoringService.username }}&quot;,
        &quot;password&quot;: &quot;{{ .Values.config.scoringService.password }}&quot;
      },
    &quot;dbCredentials&quot; : {
        &quot;url&quot;: &quot;{{ .Values.config.dbCredentials.url }}&quot;
    },
    &quot;debug&quot;: &quot;{{ .Values.config.debug }}&quot;,
    &quot;port&quot;: &quot;{{ .Values.config.port }}&quot;,
    &quot;version&quot;: &quot;{{ .Values.config.version }}&quot;
    }

</code></pre>

<p>As you can see the real values are set in the <code>values.yaml</code> file. This is an implementation decision to externalize all values in this file, we could have set the value directly in the template as they are not used anywhere else.</p>
<h3 id="modify-deploymentyaml">Modify deployment.yaml</h3>
<p>To 'inject' the configuration from the <code>configMap</code> to the server nodejs app, the trick is to specify that the <code>config.json</code> file is coming from a logical volume:</p>
<p>In the deployment.yaml we add a volumeMount point to the container specification:</p>
<pre><code class="yaml">spec:
  containers:
  - name: {{ .Chart.Name }}
    image: &quot;{{ .Values.image.repository }}:{{ .Values.image.tag }}&quot;
    imagePullPolicy: {{ .Values.image.pullPolicy }}
    ports:
    - containerPort: {{ .Values.service.internalPort }}
    volumeMounts:
    - name: config
    mountPath: /greenapp/server/config/config.json
      subPath: config.json
</code></pre>

<p>the path <em>/greenapp</em> comes from the dockerfile, working directory declaration:</p>
<pre><code class="docker">COPY . /greenapp
WORKDIR /greenapp
</code></pre>

<p>so the mountPath will overwrite the <code>config.json</code> file.</p>
<p>The volume name (config) is arbitrary but needs to match a volume declared later in the deployment.yaml.</p>
<pre><code class="yaml">
   volumes:
      - name: config
        configMap:
          name:  {{ template &quot;fullname&quot; . }}
</code></pre>

<p>One volume, named <code>config</code> uses the configMap named using the template name of the helm package and match the configMap we defined above.</p>
<p>Deploy the chart as a new release</p>
<pre><code>$ cd ../chart
$ helm install green-customerapp/ --name green-customerapp --namespace greencompute
</code></pre>

<p>Assess deployment is successful:</p>
<pre><code>$ kubectl logs &lt;pod name&gt; --namespace greencompute
</code></pre>

<p>Once deployed and started the Web application can be seen at the URL: http://greenapp.green.case</p>
<h3 id="run-the-jupyter-notebook">Run the Jupyter notebook</h3>
<p>The main root project for green compute includes a dockerfile to get all the interesting components you may want to run to execute and develop Jupyter notebooks on your own. If you use <code>docker build -t pysparktf .</code>, you should get the image with python, sklearn, all spark python modules and even Tensorflow.</p>
<pre><code>REPOSITORY                           TAG         IMAGE ID            CREATED             SIZE
pysparktf                            latest      ee5d45e40097        2 months ago        5.29G
pyspark                              latest      06821066e790        3 months ago        5.01GB
jupyter/pyspark-notebook             latest      f4f7de14d4a7        3 months ago        4.56GB

</code></pre>

<p>From those docker images you can run a container that mounts your local folder where you have notebook under the work folder. The script <code>./startLocalJupyter.sh</code>, and then run the kernel.</p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../design/code/" title="Implementation details" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Implementation details
              </span>
            </div>
          </a>
        
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.b806dc00.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:".."}})</script>
      
    
  </body>
</html>