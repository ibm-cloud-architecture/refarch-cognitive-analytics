



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.0.1">
    
    
      
        <title>API management - Customer analysis with cognitive and analytics in hybrid cloud</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.982221ab.css">
      
      
    
    
      <script src="../assets/javascripts/modernizr.1f0bcf2b.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../extra.css">
    
    
      
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="__github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#defining-customer-api-product" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href=".." title="Customer analysis with cognitive and analytics in hybrid cloud" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Customer analysis with cognitive and analytics in hybrid cloud
            </span>
            <span class="md-header-nav__topic">
              API management
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/ibm-cloud-architecture/refarch-cognitive-analytics/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    GitHub
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href=".." title="Customer analysis with cognitive and analytics in hybrid cloud" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    Customer analysis with cognitive and analytics in hybrid cloud
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/ibm-cloud-architecture/refarch-cognitive-analytics/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Welcome" class="md-nav__link">
      Welcome
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../method/readme/" title="Methodology" class="md-nav__link">
      Methodology
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Business Problem
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Business Problem
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../businessproblem/" title="Presentation" class="md-nav__link">
      Presentation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../flow/" title="Demonstration" class="md-nav__link">
      Demonstration
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4" checked>
    
    <label class="md-nav__link" for="nav-4">
      Design
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Design
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../design/readme/" title="Design considerations" class="md-nav__link">
      Design considerations
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../design/code/" title="Implementation details" class="md-nav__link">
      Implementation details
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        API management
      </label>
    
    <a href="./" title="API management" class="md-nav__link md-nav__link--active">
      API management
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#pre-requisite" title="Pre-requisite" class="md-nav__link">
    Pre-requisite
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#development-steps-done" title="Development steps done" class="md-nav__link">
    Development steps done
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#step-1-create-product-from-swagger" title="Step 1: Create product from swagger" class="md-nav__link">
    Step 1: Create product from swagger
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-2-define-operation-mapping" title="Step 2: Define operation mapping" class="md-nav__link">
    Step 2: Define operation mapping
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-3-unit-test" title="Step 3: unit test" class="md-nav__link">
    Step 3: unit test
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-4-define-and-deploy-product" title="Step 4: define and deploy product" class="md-nav__link">
    Step 4: define and deploy product
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-5-define-application-for-developer" title="Step 5: Define application for developer" class="md-nav__link">
    Step 5: Define application for developer
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-an-application" title="Create an application" class="md-nav__link">
    Create an application
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#modify-consumer" title="Modify consumer" class="md-nav__link">
    Modify consumer
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../data/" title="Data ingestion" class="md-nav__link">
      Data ingestion
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../design/scoring-serv/" title="Churn risk scoring" class="md-nav__link">
      Churn risk scoring
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../design/w-tone-analyzer/" title="Tone analyzer inegration" class="md-nav__link">
      Tone analyzer inegration
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../persist/chattranscripts/" title="Persisting the chatbot transcripts" class="md-nav__link">
      Persisting the chatbot transcripts
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../wcs/" title="Watson assistant  implementation" class="md-nav__link">
      Watson assistant  implementation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../ml/" title="Analytics implementation" class="md-nav__link">
      Analytics implementation
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Environment setup
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Environment setup
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../env/public/" title="Public" class="md-nav__link">
      Public
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../env/private/" title="Private" class="md-nav__link">
      Private
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Deployments
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        Deployments
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../deploy/local/" title="Local" class="md-nav__link">
      Local
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../deploy/iks/" title="Public IKS" class="md-nav__link">
      Public IKS
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../deploy/icp/" title="Private ICP" class="md-nav__link">
      Private ICP
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Z/" title="Z deployment" class="md-nav__link">
      Z deployment
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../labs/" title="Tutorial" class="md-nav__link">
      Tutorial
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#pre-requisite" title="Pre-requisite" class="md-nav__link">
    Pre-requisite
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#development-steps-done" title="Development steps done" class="md-nav__link">
    Development steps done
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#step-1-create-product-from-swagger" title="Step 1: Create product from swagger" class="md-nav__link">
    Step 1: Create product from swagger
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-2-define-operation-mapping" title="Step 2: Define operation mapping" class="md-nav__link">
    Step 2: Define operation mapping
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-3-unit-test" title="Step 3: unit test" class="md-nav__link">
    Step 3: unit test
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-4-define-and-deploy-product" title="Step 4: define and deploy product" class="md-nav__link">
    Step 4: define and deploy product
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-5-define-application-for-developer" title="Step 5: Define application for developer" class="md-nav__link">
    Step 5: Define application for developer
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-an-application" title="Create an application" class="md-nav__link">
    Create an application
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#modify-consumer" title="Modify consumer" class="md-nav__link">
    Modify consumer
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/ibm-cloud-architecture/refarch-cognitive-analytics/edit/master/docs/apim/README.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="defining-customer-api-product">Defining customer API product</h1>
<p>We are detailing how the <code>customer API</code> product was developed to integrate with the REST api back end. This is not a tutorial, this is more for education purpose.</p>
<h2 id="pre-requisite">Pre-requisite</h2>
<p>You need to have access to IBM API Connect management product. We have one instance within our on-premise server, soon we will use one on ICP. You need to access the swagger file from the <a href="https://github.com/ibm-cloud-architecture/refarch-integration-services/blob/master/src/main/webapp/META-INF/stub/swagger.yaml">service project</a>.</p>
<h2 id="development-steps-done">Development steps done</h2>
<h3 id="step-1-create-product-from-swagger">Step 1: Create product from swagger</h3>
<p>Connect to the API manager, our url is 172.16.40.88/apim. From the main page click <code>Add</code> and select <code>Import API from file</code></p>
<p><img alt="" src="apic-add-prod.png" />.</p>
<p>Select the swagger <code>src/main/webapp/META-INF/stub/swagger.yaml</code> from the integation-service project:</p>
<p><img alt="" src="import-swagger.png" /></p>
<p>this should create a project customer-management-micro-service-api. The Paths section of the definition includes the CRUD operation on the customers resource:</p>
<p><img alt="" src="customers-path.png" /></p>
<p>You do not need to use all the operations of the imported swagger, and it is possible to delete operations that we do not want to expose to external client applications.</p>
<p>Instead of using an already defined swagger you can develop the API definition manually in the API Designer tool and the following product documentation gives you some how to do it. https://www.ibm.com/support/knowledgecenter/en/SSMNED_5.0.0/com.ibm.apic.toolkit.doc/task_APIonPrem_createapi.html</p>
<p>Finally you can create a default product directly from the APIs:</p>
<p><img alt="" src="default-product.png" /></p>
<p>Products are just packaging for APIs and Plans.</p>
<h2 id="step-2-define-operation-mapping">Step 2: Define operation mapping</h2>
<p>You have two options here:
<em> taking the generic approach where all the defined APIs from the swagger are used as is in the new Product and the API gateway is just a proxy
</em> do some specific mappings, select a sub set of APIs and may be do some interface change.</p>
<p>API management is using its own vocabulary for such implementation:
<em> </em>Policies<em> are the building blocks of assembly flows, and they provide the means to configure capability, such as security, logging, routing of requests to target services, and transformation of data from one format to another.
</em>  Logic constructs behave in a similar way to policies, but they affect how and which parts of the assembly are implemented without modifying the data flow of the assembly.</p>
<ol>
<li>Proxy policy
  To implement a generic proxy approach, open the <code>Assembly</code> editor and create a new assembly:</li>
</ol>
<p><img alt="" src="create-assembly.png" /></p>
<p>between the two circles drag and drop a Proxy policy:</p>
<p><img alt="" src="proxy-policy.png" /></p>
<p>Then in the URL specify the end point of the virtual host name of the deployed micro service within ICP. The hostname was specified within the deployment configuration of the service when deploying it to ICP within the Ingress construct.
  <code>yaml
  ingress:
    enabled: true
    # Used to create Ingress record (should used with service.type: ClusterIP).
    hosts:
      - customer.green.case</code>
  The URL includes the webcontext and URL mapping as defined in the <code>web.xml</code> file of the java webapp.
<code>http://customer.green.case/caseserv/api/v1$(request.path)</code></p>
<p>The variable request.path is the one defined in the Paths, for example can be <code>/customers/{id}</code></p>
<p><strong>Attention!:</strong> there is something wrong here!. How API gateway that will run this product implementation will know how to map the customer.green.case host to the ICP proxy server responsible to route the traffic to the pod running the backend service? As this name is only known by ICP internal kubernetes DNS service.</p>
<p>The solution is to define static host alias inside the API Gateway, or use a DNS server inside the same network. Our API datapower gateway is on the same IP network as our ICP cluster: 172.16.<em>.</em>.</p>
<p>To add a host alias, connect to the API Gateway console using the port 9090. (https://172.16...:9090/console) as an admin user and using the Default domain so you can access the global settings. Then select network &gt; interface &gt; host alias to define a new entry.</p>
<p><img alt="" src="static-host.png" /></p>
<p>Once the configuration is saved you can use the ping remote host feature:
  <img alt="" src="ping-remote-host.png" /></p>
<p>Before going to the <a href="#step-3:-unit-test">unit test</a> let see the other approach:</p>
<ol>
<li>Map some operations</li>
</ol>
<p>For each operation, define the mapping to the back end operation. So go to the <code>Assembly editor</code>, and drag and drop the <code>Operation switch</code> logic operator:</p>
<p><img alt="" src="Assemble-operations.png" /></p>
<p>Add one case per operation you want to do a mapping to. We start by the three read only operations we need for the user interface to call: get all customer, get a customer given its id, and giving its email.</p>
<p>The following diagram illustrates an <code>Invoke</code> policy to call the back end:</p>
<p><img alt="" src="invoke-remote.png" /></p>
<p>Specify the URL as before. There is way to add scripts, mapping ... before and after the invoke if needed.</p>
<h2 id="step-3-unit-test">Step 3: unit test</h2>
<p>To unit test, you need first to <code>republish</code> the product</p>
<p><img alt="" src="republish.png" /></p>
<p>Then select the operation to trigger, like /customers/{id}, set the parameter, id=3 and <code>invoke</code> the service</p>
<p><img alt="" src="ut-invoke.png" /></p>
<p>You should get the data coming from the customer database.</p>
<p><img alt="" src="ut-response.png" /></p>
<h2 id="step-4-define-and-deploy-product">Step 4: define and deploy product</h2>
<p>Some important concepts to keep in mind: products provide a method by which you can group APIs into a package that is intended for a particular use or channel. Products contain Plans, which can be used to differentiate between different offerings.</p>
<p>To make an API available to an application developer, it <strong>must be</strong> included in a Plan. Products are then published in a Catalog.</p>
<p>A lifecycle manager can then control the availability and visibility of APIs and Plans through the API Manager. The application developer can only subscribe to one Plan from a specific Product.</p>
<p>In the product view, select the upload button on the right side to stage the product to a specific environment. Our catalog is called <code>sandbox</code>.</p>
<p><img alt="" src="Upload to sandbox.png" /></p>
<p>You can see from the figure above we select a default plan. In production you will define a plan according to business requirements. Publish the product to the catalog, you should be able to see the new URL for the API endpoint: (e.g. https://172.16.50.8/csplab/sb/customers)</p>
<p><img alt="" src="url-access.png" /></p>
<p>Once deployed developers can access the API Portal to define the application the developer will implement and that subscribed to this product.</p>
<h2 id="step-5-define-application-for-developer">Step 5: Define application for developer</h2>
<p>Using the portal at a URL like: https://172.16..../csplab/sb you can access to the API portal for developers.</p>
<p><img alt="" src="portal-main.png" /></p>
<p>Developers have an account, and need to register their application before using an API.</p>
<p>When you register an application, the application is assigned a unique client ID and client secret. You must use the client ID when you call an API that requires you to identify your application by using a client ID.</p>
<h3 id="create-an-application">Create an application</h3>
<p>In App menu, use <code>Create an application</code> button. <br />
<img alt="" src="create-app.png" /></p>
<p>Specify a name
<img alt="" src="new-customerapp.png" /></p>
<p>Then browse existing API products and select the customer API, then subscribe:</p>
<p><img alt="" src="subscribe-api.png" /></p>
<p>Now you should have a clientID to be used in future request from the application.</p>
<p><img alt="" src="client-id.png" /></p>
<p>This client id needs to be part of the HTTP header for any request to the api. You should be able to do an integration test to validate the path API product deployed on gateway -&gt; Java REST micro service on ICP -&gt; DB2, using a tool like postman or SOAP UI. The following figure illustrates a GET request to the API URL to get a customer given its id, with the setting of the <code>X-IBM-Client-Id</code> in the HTTP header.</p>
<p><img alt="" src="postman-api-test.png" />
 Cool! we get the good answer.</p>
<h3 id="modify-consumer">Modify consumer</h3>
<p>The webapp we developed for the demonstration, needs to be update to integrate the HTTP header as below:</p>
<pre><code class="javascript">var buildOptions=function(met,aPath,config){
  return {
    url: config.customerAPI.url+aPath,
    method: met,
    rejectUnauthorized: true,
    headers: {
      accept: 'application/json',
      'Content-Type': 'application/json',
      'X-IBM-Client-Id': config.customerAPI.xibmclientid,
      Host: config.customerAPI.host,
    }
  }
}
getCustomerByEmail : function(config,req,res){
  var opts = buildOptions('GET','/customers/email/'+req.params.email,config);
  opts.headers['Content-Type']='multipart/form-data';
  processRequest(res,opts);
}

</code></pre>

<p>and in the configuration file, we need to change the URL and add the new parameter:</p>
<pre><code class="json">&quot;customerAPI&quot;:{
    &quot;url&quot;:&quot;https://172.16.50.8:443/csplab/sb&quot;,
    &quot;host&quot;:&quot;customer.green.case&quot;,
    &quot;xibmclientid&quot;: &quot;d6ef6d26-f017-42e6-b703-1d8aecfe1834&quot;
}
</code></pre>

<p>Remark: the host attribute is still needed if you do not have DNS resolution in the network where ICP, API gateway are running.</p>
<h1 id="further-readings">Further readings</h1>
<ul>
<li>Tutorial on the garage method https://cloudcontent.mybluemix.net/cloud/garage/demo/try-api-connect</li>
<li>Brown compute specific API management best practices: https://github.com/ibm-cloud-architecture/refarch-integration-api#implementation-details</li>
</ul>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../design/code/" title="Implementation details" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Implementation details
              </span>
            </div>
          </a>
        
        
          <a href="../data/" title="Data ingestion" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Data ingestion
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.b806dc00.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:".."}})</script>
      
    
  </body>
</html>